
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Running CTSM at University of Florida">
      
      
      
        <link rel="canonical" href="https://cdevaneprugh.github.io/hpg-esm-docs/archive/cesm-usage/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>CESM Usage - CTSM on HiPerGator</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cesm-usage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CTSM on HiPerGator" class="md-header__button md-logo" aria-label="CTSM on HiPerGator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CTSM on HiPerGator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CESM Usage
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CTSM on HiPerGator" class="md-nav__button md-logo" aria-label="CTSM on HiPerGator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    CTSM on HiPerGator
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../onboarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Onboarding
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Glossary
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prerequisites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/fork-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fork Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/mksurfdata/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building mksurfdata
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Running CTSM
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Running CTSM
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running-ctsm/case-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Case Workflow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running-ctsm/single-point/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Single-Point Runs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running-ctsm/history-output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    History Output
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running-ctsm/spinup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Spinup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../running-ctsm/troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Research
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Research
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/hillslope/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hillslope Hydrology
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../research/neon-sites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NEON Sites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/modifications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fork Modifications
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External Resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Basics
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Basics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-recommended-reading" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Recommended Reading
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-cesm-file-structure-on-hpg" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.2 CESM File Structure on HPG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-creating-building-and-running-a-case-on-hpg" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.3 Creating, Building, and Running a Case on HPG
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-example-case" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.4 Example Case
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-single-point-cases-in-cesm" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Single Point Cases in CESM
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Single Point Cases in CESM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-clm-best-practices-and-where-our-pts-run-went-wrong" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 CLM Best Practices and Where Our PTS Run Went Wrong
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-compset-testing" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Compset Testing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-single-point-with-spin-up-slides" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Single Point With Spin Up (Slides)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Single Point With Spin Up (Slides)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exercise-4a-create-a-global-case" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4a: Create a Global Case
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4b-generate-domain-and-surface-data-sets" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4b: Generate Domain and Surface Data Sets
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4c-create-a-new-case-for-the-single-point-run" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4c: Create a New Case for the Single Point Run
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exercise-4d-single-point-bgc_ad" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4d: Single Point BGC_AD
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cesm-usage">CESM Usage<a class="headerlink" href="#cesm-usage" title="Permanent link">&para;</a></h1>
<ol>
<li><a href="basic-usage-of-cesm">Basics</a></li>
</ol>
<p>1.1 <a href="recommended-reading">Recommended Reading</a></p>
<p>1.2 <a href="cesm-file-structure-on-hpg">File Structure</a></p>
<p>1.3 <a href="cesm_case">Creating, Building, and Running a Case</a></p>
<p>1.4 <a href="clm_example">Example</a></p>
<ol>
<li><a href="pts_mode">Single Point Cases</a></li>
</ol>
<p>2.1 <a href="clm_best_practices">Best Practices</a></p>
<p>2.2 <a href="clm_compset_testing">Compset Testing</a></p>
<ol>
<li><a href="pts_slides">Single Point With Spin Up</a></li>
</ol>
<h2 id="1-basics">1. Basics<a name="basic-usage-of-cesm"></a><a class="headerlink" href="#1-basics" title="Permanent link">&para;</a></h2>
<h3 id="11-recommended-reading">1.1 Recommended Reading<a name="recommended-reading"></a><a class="headerlink" href="#11-recommended-reading" title="Permanent link">&para;</a></h3>
<p>There are three pieces of documentation that I strongly suggest you read through to familiarize yourself with the process of creating cases on CESM.</p>
<ol>
<li>The <a href="https://escomp.github.io/CESM/versions/cesm2.1/html/quickstart.html">quick start</a> section of CESM's documentation.</li>
<li>The <a href="https://esmci.github.io/cime/versions/master/html/users_guide/index.html">Using the Case Control System</a> section of the CIME documentation.</li>
<li>The <a href="https://escomp.github.io/ctsm-docs/versions/release-clm5.0/html/users_guide/index.html">clm documentation</a>, as the SWES department primarily uses <code>clm</code>, the land model component of CESM.</li>
</ol>
<h3 id="12-cesm-file-structure-on-hpg">1.2 CESM File Structure on HPG<a name="cesm-file-structure-on-hpg"></a><a class="headerlink" href="#12-cesm-file-structure-on-hpg" title="Permanent link">&para;</a></h3>
<p>For the "gerber" group on HiPerGator, CESM has been installed in <code>/blue/gerber/earth_models/cesm2.1.5</code>. The scripts to create a new case or query information about case options are located in <code>/blue/gerber/earth_models/cesm2.1.5/cime/scripts</code>.</p>
<p>If you leave the <code>machine_config.xml</code> at its default settings, and create a "cases" directory at <code>/blue/GROUP/USER/cases</code>, the directory tree at <code>/blue/GROUP/USER</code> should look something like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>.
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>├──<span class="w"> </span>cases
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>│<span class="w">   </span>└──<span class="w"> </span>EXAMPLE_CASE
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>└──<span class="w"> </span>earth_model_output
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span>├──<span class="w"> </span>cesm_baselines
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span>├──<span class="w"> </span>cime_output_root
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span>│<span class="w">   </span>├──<span class="w"> </span>archive
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span>│<span class="w">   </span>└──<span class="w"> </span>EXAMPLE_CASE
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">    </span>│<span class="w">       </span>├──<span class="w"> </span>bld
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span>│<span class="w">       </span>└──<span class="w"> </span>run
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">    </span>└──<span class="w"> </span>timings
</code></pre></div>
<h3 id="13-creating-building-and-running-a-case-on-hpg">1.3 Creating, Building, and Running a Case on HPG<a name="cesm_case"></a><a class="headerlink" href="#13-creating-building-and-running-a-case-on-hpg" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># cd to the cime scripts directory</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/earth_models/cime/scripts
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1"># create your case, specifying the case location, compset, and resolution</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>./create_newcase<span class="w"> </span>--case<span class="w"> </span>/blue/GROUP/USER/cases/EXAMPLE_CASE<span class="w"> </span>--compset<span class="w"> </span>COMPSET<span class="w"> </span>--res<span class="w"> </span>RESOLUTION
</code></pre></div>
<p>CIME will output a bunch of text, then say whether the the case was created successfully, and where it was created.
If you are running a compset that is not scientifically validated, you will have to add the <code>--run-unsupported</code> option to your <code>create_newcase</code> command.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># go to the case directory</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nb">cd</span><span class="w"> </span>/blue/GROUP/USER/cases/case1
</code></pre></div>
<p>For the "Gerber" group, there are a few variables that we will most likely need to change. The first is the number of cores used by the model. Most compsets will request one (or several) nodes (128-512 cores) by default.
Our research group only has access to 20 cores on our default queue, so we need to make sure we're under the QOS limit. We can do this with the <code>xmlchange</code> script.</p>
<p>First check how many cores each component is requesting by running <code>./pelayout</code>, which will list out the individual components, along with what resources they are asking for.
The variable we want to pay atention to is <code>NTASKS</code>. This corresponds to how many cores will be requested when the case is submitted.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="c1"># change the number of cores to something more sensible</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>./xmlchange<span class="w"> </span><span class="nv">NTASKS</span><span class="o">=</span><span class="m">8</span>
</code></pre></div>
<p>This will take us down to using only 8 cores when we run the case.</p>
<p>The downside of using fewer cores, is that we may have to run the case for longer on the compute node. We can extend the time requested by changeing the <code>JOB_WALLCLOCK_TIME</code> variable.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># check the current setting</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>./xmlquery<span class="w"> </span>JOB_WALLCLOCK_TIME
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="c1"># change the variable if needed</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>./xmlchange<span class="w"> </span><span class="nv">JOB_WALLCLOCK_TIME</span><span class="o">=</span><span class="m">1</span>:00:00
</code></pre></div>
<p>If you're unsure of the exact name of the varibale you want to check/change, you can list all the defined variables, then pipe to grep and search.
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># running grep with the -i flag will ignore case distinction</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>./xmlquery<span class="w"> </span>--listall<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>SEARCH_TERM
</code></pre></div>
Once you've set all of your variables, setup, build, and submit the case as usual.
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>./case.setup
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>./case.build
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>./case.submit
</code></pre></div></p>
<p>If you setup and build the case but realize you need to change some variables before submitting, it's a good idea to clean the case before rebuilding. We can do this with something like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>./xmlchange<span class="w"> </span>SOME_VARIABLE
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>./case.setup<span class="w"> </span>--clean
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>./case.build<span class="w"> </span>--clean
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>./case.setup
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>./case.build
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>./case.submit
</code></pre></div>
<h3 id="14-example-case">1.4 Example Case<a name="clm_example"></a><a class="headerlink" href="#14-example-case" title="Permanent link">&para;</a></h3>
<p>Here is an example of creating, building, and running a case with a compset typical of what we would use in the SWES department.
The long name for our compset is <code>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV</code> and the resolution we will be using is <code>f19_g17</code>. 
While we can certainly use the long name for the compset, sometimes it's nicer to use the alias (assuming one is available). Here's a trick for finding your compset's alias.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># cd to the cesm, cime scripts</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/earth_models/cesm215/cime/scripts
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># use the query config script, then pipe it to grep and search the compset&#39;s long name</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>./query_config<span class="w"> </span>--compsets<span class="w"> </span>all<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV
</code></pre></div>
<p>Which should output the following.
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>I1850Clm50SpCru<span class="w">      </span>:<span class="w"> </span>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV
</code></pre></div></p>
<p>Now we can create the case.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># cd to the cesm, cime scripts</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/earth_models/cesm215/cime/scripts
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="c1"># create the case using a sensible name, the compset alias, and desired resolution</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>./create_newcase<span class="w"> </span>--case<span class="w"> </span>/blue/GROUP/USER/cases/EXAMPLE_CASE<span class="w"> </span>--compset<span class="w"> </span>I1850Clm50SpCru<span class="w"> </span>--res<span class="w"> </span>f19_g17
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="c1"># cd to the case directory</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="nb">cd</span><span class="w"> </span>/blue/GROUP/USER/cases/EXAMPLE_CASE
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="c1"># check the amount of cores being requested by default</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>./xmlquery<span class="w"> </span>NTASKS
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="c1"># it&#39;s probably going to be higher than our QOS, so we need to change it along with extending the job time</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>./xmlchange<span class="w"> </span><span class="nv">NTASKS</span><span class="o">=</span><span class="m">8</span>,JOB_WALLCLOCK_TIME<span class="o">=</span><span class="m">1</span>:00:00
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="c1"># setup the case</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>./case.setup
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="c1"># check the submit script to make sure it&#39;s requesting the correct amount of resources</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a>./preview_run
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="c1"># if everything looks good, build the case (this can take a few minutes)</span>
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a>./case.build
<a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a>
<a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="c1"># submit the case to the scheduler and run the experiment</span>
<a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a>./case.submit
</code></pre></div>
<p>Check your UF email for updates from the <code>SLURM</code> scheduler. A case can fail for many reasons, most of which should be pretty obvious.
If you accidentally requested more resources than your QOS allows, it will tell you in the email. If your case fails with an OOM (out of memory) error, try increasing the number of cores by changing the <code>NTASKS</code> variable.
You may want to switch to your burst QOS sometimes. You can set this manually by changing the <code>JOB_QUEUE</code> variable (using the <code>xmlchange</code> script) to the name of your burst QOS. On hipergator your burst queue is your group name with "-b" appended. So the burst queue for the "gerber" group is gerber-b.</p>
<h2 id="2-single-point-cases-in-cesm">2. Single Point Cases in CESM<a name="pts_mode"></a><a class="headerlink" href="#2-single-point-cases-in-cesm" title="Permanent link">&para;</a></h2>
<p>Following the instructions <a href="https://escomp.github.io/ctsm-docs/versions/release-clm5.0/html/users_guide/running-single-points/running-pts_mode-configurations.html">here</a>, we can run the clm model on a single grid cell by specifying a latitude and longitude. However, the instructions on the clm website seem to be a bit outdated. CIME no longer supports the <code>-pts_lat</code> or <code>-pts_lon</code>  arguments with the <code>create_newcase</code> script, also multi-character arguments should begin with <code>--</code> rather than <code>-</code>.  We can still run on a single point by creating a new case, then changing the appropriate variables before building the executable.</p>
<p><strong>A Note on DATM_MODE</strong> <a href="https://www2.cgd.ucar.edu/events/2019/ctsm/files/practical4-wieder.pdf#page=16">source</a></p>
<p>There are five modes used with CLM that specify the type of Meteorological data that’s used.
1. CLMGSWP3 (this is the preferred meteorological data to use w/ CLM5)
2. CLMCRUNCEP (Use global NCEP forcing at half-degree resolution from CRU goes from 1900-2010. GSWP3 similar time period and spatial resolution).
3. CLM_QIAN (Deprecated. Use NCEP forcing at T62 resolution corrected by Qian et. al. goes from 1948-2004).
4. CLM1PT (Use the local meteorology from your specific tower site).
5. CPLHIST (This name may have changed. Use atmospheric data from a previous CESM simulation).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># cd to cime/scripts </span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/earth_models/cime/scripts
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="c1"># find the shortname for the compset</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>./query_config<span class="w"> </span>--compsets<span class="w"> </span>all<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV
</code></pre></div>
<p>Which outputs the following to the terminal.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>I1850Clm50SpCru      : 1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV
</code></pre></div>
<p>To create our case we can do something like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>./create_newcase<span class="w"> </span>--case<span class="w"> </span>/blue/gerber/cdevaneprugh/cases/testPTS_OSBS<span class="w"> </span>--res<span class="w"> </span>f19_g17<span class="w"> </span>--compset<span class="w"> </span>I1850Clm50SpCru
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="c1"># cd to the case directory</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/cdevaneprugh/cases/testPTS_OSBS
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="c1"># change variables to run on a single point</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>./xmlchange<span class="w"> </span><span class="nv">PTS_MODE</span><span class="o">=</span>TRUE,PTS_LAT<span class="o">=</span><span class="m">29</span>.7,PTS_LON<span class="o">=</span>-82.0
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>./xmlchange<span class="w"> </span><span class="nv">CLM_FORCE_COLDSTART</span><span class="o">=</span>on,RUN_TYPE<span class="o">=</span>startup
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="c1"># change variables to use a single core and adjust wall time</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>./xmlchange<span class="w"> </span><span class="nv">NTASKS</span><span class="o">=</span><span class="m">1</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>./xmlchange<span class="w"> </span><span class="nv">JOB_WALLCLOCK_TIME</span><span class="o">=</span><span class="m">1</span>:00:00
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="c1"># setup, build, and submit the case as usual</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>./case.setup
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>./case.build
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>./case.submit
</code></pre></div>
<p>This case will build and download input data, but fail during runtime with the following mpi error.  </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>MPI_ABORT<span class="w"> </span>was<span class="w"> </span>invoked<span class="w"> </span>on<span class="w"> </span>rank<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>communicator<span class="w"> </span>MPI_COMM_WORLD<span class="w"> </span>with<span class="w"> </span>errorcode<span class="w"> </span><span class="m">2</span>.
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>NOTE:<span class="w"> </span>invoking<span class="w"> </span>MPI_ABORT<span class="w"> </span>causes<span class="w"> </span>Open<span class="w"> </span>MPI<span class="w"> </span>to<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>all<span class="w"> </span>MPI<span class="w"> </span>processes.
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>You<span class="w"> </span>may<span class="w"> </span>or<span class="w"> </span>may<span class="w"> </span>not<span class="w"> </span>see<span class="w"> </span>output<span class="w"> </span>from<span class="w"> </span>other<span class="w"> </span>processes,<span class="w"> </span>depending<span class="w"> </span>on<span class="w"> </span>exactly<span class="w"> </span>when<span class="w"> </span>Open<span class="w"> </span>MPI<span class="w"> </span>kills<span class="w"> </span>them.
</code></pre></div>
<p>Following advice on <a href="https://bb.cgd.ucar.edu/cesm/threads/issues-downloading-input-data-in-clm5-single-point-mode.9600/#post-55331">my forum post</a>, I tried a different compset which worked perfectly.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># create case</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>./create_newcase<span class="w"> </span>--case<span class="w"> </span>/blue/gerber/cdevaneprugh/cases/osbsPTSmod<span class="w"> </span>--compset<span class="w"> </span>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_SROF_SGLC_SWAV<span class="w"> </span>--res<span class="w"> </span>f19_g17<span class="w"> </span>--run-unsupported
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/cdevaneprugh/cases/osbsPTSmod
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="c1"># change variables</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>./xmlchange<span class="w"> </span><span class="nv">NTASKS</span><span class="o">=</span><span class="m">1</span>,JOB_WALLCLOCK_TIME<span class="o">=</span><span class="m">1</span>:00:00
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>./xmlchange<span class="w"> </span><span class="nv">PTS_MODE</span><span class="o">=</span>TRUE,PTS_LAT<span class="o">=</span><span class="m">29</span>.7,PTS_LON<span class="o">=</span>-82.0
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>./xmlchange<span class="w"> </span><span class="nv">CLM_FORCE_COLDSTART</span><span class="o">=</span>on,RUN_TYPE<span class="o">=</span>startup
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="c1"># setup and build case like normal</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>./case.setup
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>./case.build
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="c1"># check input data</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>./check_input_data
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="c1"># submit case</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>./case.submit
</code></pre></div>
The next section will go into where we went wrong, and some things we can do to have successful runs in the future.</p>
<h3 id="21-clm-best-practices-and-where-our-pts-run-went-wrong">2.1 CLM Best Practices and Where Our PTS Run Went Wrong<a name="clm_best_practices"></a><a class="headerlink" href="#21-clm-best-practices-and-where-our-pts-run-went-wrong" title="Permanent link">&para;</a></h3>
<p>The full comment from my <a href="https://bb.cgd.ucar.edu/cesm/threads/issues-downloading-input-data-in-clm5-single-point-mode.9600/#post-55331">post</a> is:</p>
<blockquote>
<p>The error message in the cesm log is:</p>
<p>MCT::m_SparseMatrixPlus:: FATAL--length of vector y different from row count of sMat.Length of y = 1 Number of rows in sMat = 13824
000.MCT(MPEU)::die.: from MCT::m_SparseMatrixPlus::initDistributed_()</p>
<p>It seems like there must be mismatch between two of the datasets you are using. One seems to be single point (y=1) and the other is 1.9x2.5 (144x96=13824). I think it might be because the compset you are using has CISM and MOSART in it. The long name for that compset is:</p>
<p>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV</p>
<p>Try specifying stubs for those, e.g.,</p>
<p>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_SROF_SGLC_SWAV</p>
</blockquote>
<p>So the hypothesis is that any compset with MOSART or CISM will cause an issue in single point mode. Okay, so the easiest option is to just pick a compset we like, then specify stubs in the same way that was suggested in the post. The only problem is that doing this turns our compset into one that is not scientifically validated. This might not be an issue for our purposes. I also noticed an interesting thing in the <a href="https://escomp.github.io/ctsm-docs/versions/release-clm5.0/html/users_guide/overview/introduction.html#best-practices">clm documentation's best practices section</a>.</p>
<blockquote>
<p>CLM5.0 includes BOTH the old CLM4.0, CLM4.5 physics AND the new CLM5.0 physics and you can toggle between those three. The “standard” practice for CLM4.0 is to run with CN on, and with Qian atmospheric forcing. While the “standard” practice for CLM4.5 is to run with BGC on, and CRUNCEP atmospheric forcing. And finally the “standard” practice for CLM5.0 is to run with BGC and Prognostic Crop on, with the MOSART model for river routing, as well as the CISM ice sheet model, and using GSWP3 atmospheric forcing. “BGC” is the new CLM5.0 biogeochemistry and include CENTURY-like pools, vertical resolved carbon, as well as Nitrification and de-Nitrification</p>
</blockquote>
<p>So if it is best practice to use MOSART as well as CISM for clm5.0, maybe we can just use the clm4.0 or 4.5 physics instead. For a test, I'm going to look at the initial compsets Stefan gave to me, then see if I can find the equivalent one that is running clm4.0 or 4.5 and test those.</p>
<p>Looking at the compsets, the one suggested in the forum post is effectively the clm4.0 version of what Stefan wanted, but with clm5.0 physics substituted (remember this doesn't follow best practices and is not scientifically validated). There are also plenty of scientifically valid compsets that don't use MOSART or CISM.</p>
<p>It would be interesting to see if I can narrow down which is messing us up. I'll find a compset with only CISM, see if that runs globally and in single point mode, then repeat with a compset containing MOSART.</p>
<p>With the abundance of compsets and resolutions, I'm going to need a better naming convention for my case directories. I think something like <code>compset.resolution.modifiers</code> would work. For example the name for our initial single point test (that failed) would be <code>I1850Clm50SpCru.f19_g17.PTS</code>.</p>
<h3 id="22-compset-testing">2.2 Compset Testing<a name="clm_compset_testing"></a><a class="headerlink" href="#22-compset-testing" title="Permanent link">&para;</a></h3>
<p>Anytime we get an error that is something like:</p>
<blockquote>
<p>MCT::m_SparseMatrixPlus:: FATAL--length of vector y different from row count of sMat.Length of y = 1 Number of rows in sMat = 55296</p>
</blockquote>
<p>We can assume there is some issue with MOSART or CISM. The goal of running the following cases is to determine which is causing the error in single point mode.
I did this by choosing similar compsets that use physics from clm4.0 4.5 and 5.0 as well as running a global and PTS version of each compset.</p>
<p><strong>Compset Long Name :   Compset Alias   :   Resolution Used</strong></p>
<p><strong>1850_DATM%CRUv7_CLM40%SP_SICE_SOCN_RTM_SGLC_SWAV  :   I1850Clm40SpCruGs   :   f19_g17</strong></p>
<ol>
<li>
<p>Global: Success</p>
</li>
<li>
<p>PTS: Success</p>
</li>
</ol>
<p><strong>1850_DATM%GSWP3v1_CLM45%CN_SICE_SOCN_RTM_CISM2%NOEVOLVE_SWAV  :   I1850Clm45Cn    :   f19_g17</strong></p>
<ol>
<li>
<p>Global: Success</p>
</li>
<li>
<p>PTS: Fail </p>
</li>
</ol>
<blockquote>
<p>MCT::m_SparseMatrixPlus:: FATAL--length of vector y different from row count of sMat.Length of y = 1 Number of rows in sMat = 13824</p>
<p>000.MCT(MPEU)::die.: from MCT::m_SparseMatrixPlus::initDistributed_()</p>
</blockquote>
<p><strong>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV :   I1850Clm50SpCru :   f19_g17</strong></p>
<ol>
<li>
<p>Global: Success</p>
</li>
<li>
<p>PTS: Fail</p>
</li>
</ol>
<blockquote>
<p>MCT::m_SparseMatrixPlus:: FATAL--length of vector y different from row count of sMat.Length of y = 1 Number of rows in sMat = 13824</p>
<p>000.MCT(MPEU)::die.: from MCT::m_SparseMatrixPlus::initDistributed_()</p>
</blockquote>
<p><strong>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_SROF_SGLC_SWAV :   NONE    :   f19_g17</strong></p>
<ol>
<li>
<p>Global: Success</p>
</li>
<li>
<p>PTS: Success</p>
</li>
</ol>
<p><strong>2000_DATM%GSWP3v1_CLM50%SP-VIC_SICE_SOCN_RTM_CISM2%NOEVOLVE_SWAV  :   I2000Clm50Vic   :   f09_g17</strong></p>
<ol>
<li>
<p>Global:</p>
</li>
<li>
<p>PTS:</p>
</li>
</ol>
<p><strong>HIST_DATM%GSWP3v1_CLM40%SP_SICE_SOCN_RTM_SGLC_SWAV    :   IHistClm40SpGswGs   :   f09_g17</strong></p>
<ol>
<li>Global: Success</li>
<li>PTS: Success</li>
</ol>
<p><strong>HIST_DATM%GSWP3v1_CLM45%SP_SICE_SOCN_RTM_SGLC_SWAV    :   IHistClm45SpGs  :   f09_g17</strong></p>
<ol>
<li>Global: Fail (Out of Memory)</li>
</ol>
<blockquote>
<p>Primary job  terminated normally, but 1 process returned a non-zero exit code. Per user-direction, the job has been aborted.</p>
</blockquote>
<ol>
<li>PTS: Success</li>
</ol>
<p><strong>HIST_DATM%QIA_CLM50%BGC_SICE_SOCN_MOSART_SGLC_SWAV    :   IHistClm50BgcQianGs :   f09_g17</strong></p>
<ol>
<li>Global: Fail (Out of Memory)</li>
</ol>
<blockquote>
<p>Primary job  terminated normally, but 1 process returned a non-zero exit code. Per user-direction, the job has been aborted.</p>
</blockquote>
<ol>
<li>PTS: Success</li>
</ol>
<p><strong>HIST_DATM%GSWP3v1_CLM50%SP_SICE_SOCN_MOSART_CISM2%NOEVOLVE_SWAV   :   IHistClm50Sp    :   f09_g17</strong></p>
<ol>
<li>Global: Fail (Out of Memory)</li>
</ol>
<blockquote>
<p>Primary job  terminated normally, but 1 process returned a non-zero exit code. Per user-direction, the job has been aborted.</p>
</blockquote>
<ol>
<li>PTS: Fail</li>
</ol>
<blockquote>
<p>MCT::m_SparseMatrixPlus:: FATAL--length of vector y different from row count of sMat.Length of y = 1 Number of rows in sMat = 55296</p>
<p>000.MCT(MPEU)::die.: from MCT::m_SparseMatrixPlus::initDistributed_()</p>
</blockquote>
<p><strong>Conclusion</strong>
It looks like CISM is the issue. The Qian case (IHistClm50BgcQianGs) uses MOSART and the PTS mode case ran successfully.</p>
<h2 id="3-single-point-with-spin-up-slides">3. Single Point With Spin Up (<a href="https://www2.cgd.ucar.edu/events/2019/ctsm/files/practical4-wieder.pdf">Slides</a>)<a name="pts_slides"></a><a class="headerlink" href="#3-single-point-with-spin-up-slides" title="Permanent link">&para;</a></h2>
<p>I'll go through the exercises in order here, and note any issues I ran in to or modifications I had to make.</p>
<h3 id="exercise-4a-create-a-global-case">Exercise 4a: Create a Global Case<a name='ex_4a"></a><a class="headerlink" href="#exercise-4a-create-a-global-case" title="Permanent link">&para;</a></h3>
<p>The compset I'll be using is <code>HIST_DATM%GSWP3v1_CLM50%SP_SICE_SOCN_MOSART_SGLC_SWAV</code> which is a modified version of the supported compset <code>IHistClm50Sp</code> that removes the CISM portion of the model.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># cd to cime scripts</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/earth_models/cesm215/cime/scripts
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1"># create our case</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>./create_newcase<span class="w"> </span>--case<span class="w"> </span>/blue/gerber/cdevaneprugh/cases/IHistClm50Sp_001<span class="w"> </span>--compset<span class="w"> </span>HIST_DATM%GSWP3v1_CLM50%SP_SICE_SOCN_MOSART_SGLC_SWAV<span class="w"> </span>--res<span class="w"> </span>f09_g17<span class="w"> </span>--run-unsupported
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="c1"># cd to case</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/cdevaneprugh/cases/IHistClm50Sp_001
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>./case.setup
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>./preview_namelists
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="c1"># Look for the path to the surface data set and domain file</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>cat<span class="w"> </span>CaseDocs/lnd_in
</code></pre></div>
<h3 id="exercise-4b-generate-domain-and-surface-data-sets">Exercise 4b: Generate Domain and Surface Data Sets<a name="ex_4b"></a><a class="headerlink" href="#exercise-4b-generate-domain-and-surface-data-sets" title="Permanent link">&para;</a></h3>
<p>It looks like there's a script called <code>singlept</code> that we need access to. I think this was provided during the workshop on the NCAR server being used. Additionally, there is a <code>ncar_pylib</code> I need access to, it's possible this is available to download with <code>conda</code>.
There was a list of many options that are changed in the <code>singlept</code> script but I can't find the variables they are setting when using <code>xmlquery</code> and looking in the <code>CaseDocs</code> directory.</p>
<h3 id="exercise-4c-create-a-new-case-for-the-single-point-run">Exercise 4c: Create a New Case for the Single Point Run<a name="ex_4c"></a><a class="headerlink" href="#exercise-4c-create-a-new-case-for-the-single-point-run" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># cd to cime scripts</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/earth_models/cesm215/cime/scripts
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="c1"># create a new compset with a stub ice and river model</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>./create_newcase<span class="w"> </span>--case<span class="w"> </span>/blue/gerber/cdevaneprugh/cases/ex_4c<span class="w"> </span>--compset<span class="w"> </span>1850_DATM%CRUv7_CLM50%SP_SICE_SOCN_SROF_SGLC_SWAV<span class="w"> </span>--res<span class="w"> </span>f09_g17<span class="w"> </span>--run-unsupported
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="c1"># go to case directory</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="nb">cd</span><span class="w"> </span>/blue/gerber/cdevaneprugh/cases/ex_4c
</code></pre></div>
<p>Following the guide there are many variables to change. Rather than list them all out, use the script <code>ready_clm_case</code> provided in this repository.
Note: You should not change the <code>MPILIB</code> variable to <code>mpi-serial</code>. On our system, things seem to break if you do this. I am still unsure why.
On <a href="https://www2.cgd.ucar.edu/events/2019/ctsm/files/practical4-wieder.pdf#page=30">page 30</a> of the slides they need the new domain files that we would have made in exercise 4b. We'll have to skip this part for now.</p>
<p>It <em>looks</em> like all the variables were changed successfully, and the model was built. Unfortunately without those scripts from the workshop, we're sort of stuck. </p>
<h3 id="exercise-4d-single-point-bgc_ad">Exercise 4d: Single Point BGC_AD<a name="ex_4d"></a><a class="headerlink" href="#exercise-4d-single-point-bgc_ad" title="Permanent link">&para;</a></h3>
<p>The xml variable changes are almost identical to exercise 4c, with one or two exceptions. Unfortunately, we run into the same problem here in that we need the scripts from exercise 4b.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "navigation.expand", "search.suggest", "search.highlight", "content.code.copy"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>